document.addEventListener('DOMContentLoaded', function() {
    // Telegram WebApp initialization
    const tg = window.Telegram?.WebApp;
    if (tg) {
        tg.ready();
        tg.expand();
    }

    // Screen and button elements
    const screens = {
        home: document.getElementById('homeScreen'),
        left: document.getElementById('leftScreen'),
        right: document.getElementById('rightScreen'),
        profile: document.getElementById('profileScreen'),
        bot: document.getElementById('botScreen'),
        chat: document.getElementById('chatScreen'),
        dating: document.getElementById('datingScreen')
    };

    const buttons = {
        home: document.getElementById('homeBtn'),
        left: document.getElementById('leftBtn'),
        right: document.getElementById('rightBtn'),
        profile: document.getElementById('profileBtn'),
        bot: document.getElementById('botBtn'),
        chat: document.getElementById('chatBtn'),
        dating: document.getElementById('datingBtn')
    };

    let currentScreen = 'home';
    let isAnimating = false;

    // Screen navigation function
    function showScreen(screenName) {
        if (isAnimating) return;
        isAnimating = true;

        // Hide current screen
        screens[currentScreen].classList.remove('active');
        // Show new screen
        screens[screenName].classList.add('active');
        
        // Vibration on screen change
        if (tg?.HapticFeedback) {
            tg.HapticFeedback.impactOccurred('medium');
        }

        currentScreen = screenName;
        
        setTimeout(() => {
            isAnimating = false;
        }, 300);
    }

    // Add event listeners for all navigation buttons
    Object.keys(buttons).forEach(key => {
        buttons[key].addEventListener('click', () => showScreen(key));
    });

    // Global Chat functionality
    const globalChatMessages = document.getElementById('global-chat-messages');
    const globalChatInput = document.getElementById('global-chat-input');
    const globalSendBtn = document.getElementById('global-send-btn');

    function addGlobalChatMessage(message, type) {
        const messageEl = document.createElement('div');
        messageEl.classList.add('chat-message', type);
        messageEl.textContent = message;
        globalChatMessages.appendChild(messageEl);
        globalChatMessages.scrollTop = globalChatMessages.scrollHeight;
    }

    function sendGlobalMessage() {
        const message = globalChatInput.value.trim();
        if (message) {
            // User message
            addGlobalChatMessage(message, 'user-message');
            
            // Simple bot response
            setTimeout(() => {
                addGlobalChatMessage('Привет! Это глобальный чат.', 'bot-message');
            }, 500);

            globalChatInput.value = '';
        }
    }

    globalSendBtn.addEventListener('click', sendGlobalMessage);
    globalChatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendGlobalMessage();
    });

    // Dating Profile Form
    const datingProfileForm = document.getElementById('dating-profile-form');
    
    datingProfileForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Collect profile data
        const profileData = {
            name: document.getElementById('name-input').value,
            age: document.getElementById('age-input').value,
            city: document.getElementById('city-input').value,
            about: document.getElementById('about-input').value
        };
        
        // Here you would typically send this data to a backend
        // For now, we'll just show an alert
        alert('Профиль сохранен: ' + JSON.stringify(profileData, null, 2));
    });
});
