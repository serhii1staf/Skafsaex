 Enable logging
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO
)
logger = logging.getLogger(__name__)

# Define states for ConversationHandler
MAIN_MENU, UPLOAD, PROFILE, SETTINGS = range(4)

# Start command handler
def start(update: Update, context: CallbackContext) -> int:
    reply_keyboard = [['Плюс', 'Профиль', 'Настройки', 'Вернуться на главный экран']]
    markup = ReplyKeyboardMarkup(reply_keyboard, one_time_keyboard=True, resize_keyboard=True)
    update.message.reply_text(
        "Добро пожаловать! Пожалуйста, выберите опцию:", reply_markup=markup
    )
    return MAIN_MENU

# Upload command handler
def upload(update: Update, context: CallbackContext) -> int:
    update.message.reply_text(
        "Пожалуйста, загрузите ваши данные. (Введите произвольный текст)", reply_markup=ReplyKeyboardRemove()
    )
    return UPLOAD

# Profile command handler
def profile(update: Update, context: CallbackContext) -> int:
    update.message.reply_text(
        "Введите ваш номер телефона, фотографию, имя и город проживания. (Введите произвольный текст)", reply_markup=ReplyKeyboardRemove()
    )
    return PROFILE

# Settings command handler
def settings(update: Update, context: CallbackContext) -> int:
    reply_keyboard = [['Обычный режим', 'Стандартный режим', 'Премиум-режим', 'Вернуться на главный экран']]
    markup = ReplyKeyboardMarkup(reply_keyboard, one_time_keyboard=True, resize_keyboard=True)
    update.message.reply_text(
        "Выберите режим:", reply_markup=markup
    )
    return SETTINGS

# Handle received data
def received_data(update: Update, context: CallbackContext) -> int:
    user_data = update.message.text
    update.message.reply_text(f"Данные сохранены: {user_data}")
    return start(update, context)

# Handle settings selection
def handle_settings(update: Update, context: CallbackContext) -> int:
    selected_setting = update.message.text
    update.message.reply_text(f"Вы выбрали: {selected_setting}")
    return start(update, context)

# Home command handler
def home(update: Update, context: CallbackContext) -> int:
    return start(update, context)

# Cancel command handler
def cancel(update: Update, context: CallbackContext) -> int:
    update.message.reply_text('Прощай!', reply_markup=ReplyKeyboardRemove())
    return ConversationHandler.END

def main() -> None:
    # Create the Updater and pass it your bot's token.
    updater = Updater("7905507634:AAFNT_tZ0rv0oew7_8e9N-O36DEYoLwuL28")

    # Get the dispatcher to register handlers
    dispatcher = updater.dispatcher

    # Define a conversation handler with the states MAIN_MENU, PROFILE, SETTINGS, UPLOAD
    conv_handler = ConversationHandler(
        entry_points=[CommandHandler('start', start)],
        states={
            MAIN_MENU: [
                MessageHandler(Filters.regex('^(Плюс)$'), upload),
                MessageHandler(Filters.regex('^(Профиль)$'), profile),
                MessageHandler(Filters.regex('^(Настройки)$'), settings),
                MessageHandler(Filters.regex('^(Вернуться на главный экран)$'), home),
            ],
            UPLOAD: [
                MessageHandler(Filters.text & ~Filters.command, received_data),
                MessageHandler(Filters.regex('^(Вернуться на главный экран)$'), home)
            ],
            PROFILE: [
                MessageHandler(Filters.text & ~Filters.command, received_data),
                MessageHandler(Filters.regex('^(Вернуться на главный экран)$'), home)
            ],
            SETTINGS: [
                MessageHandler(Filters.regex('^(Обычный режим|Стандартный режим|Премиум-режим)$'), handle_settings),
                MessageHandler(Filters.regex('^(Вернуться на главный экран)$'), home)
            ],
        },
        fallbacks=[CommandHandler('cancel', cancel)],
    )

    dispatcher.add_handler(conv_handler)

    # Start the Bot
    updater.start_polling()
    updater.idle()

if __name__ == '__main__':
    main()
